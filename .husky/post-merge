#!/bin/sh

echo "ğŸ” Running post-merge hook..."

echo "ğŸ“¦ Installing dependencies with strict lockfile sync..."
if ! bun install --frozen-lockfile; then
  echo "âŒ bun install failed at $(date -u '+%Y-%m-%d %H:%M:%S GMT')."
  echo "   Please resolve lockfile or dependency issues before continuing."
  exit 1
fi

echo "âœ… Dependencies are up to date."

# Detect if database package was touched in the merge
files_branch=$(git diff --name-only HEAD@{1}...HEAD)
database_changed=$(echo "$files_branch" | grep -E '^packages/database/' | sort -u)

if [ -n "$database_changed" ]; then
  echo "ğŸ’¡ Reminder: Since packages/database changed, you may need to run:"
  echo "   bun run db:generate"
  echo "   bun run db:push"
fi

echo "ğŸ’¡ For all projects, ensure database connection strings are configured correctly."

echo "ğŸ‰ Post-merge checks completed successfully at $(date -u '+%Y-%m-%d %H:%M:%S GMT')."
